/*------------------------------------------------------------------------------------------------*\
    Fall-Back Search Form Pattern v0.1
\*------------------------------------------------------------------------------------------------*/

// Colours:

// Slightly hacky way of allowing the main UI colour of this pattern to be:
// - base-ui colour (if set)
// - otherwise #999 
// - but can be specifically overridden
$t: false;
@if variable-exists(fallback--base-ui-color) {
    $t: $fallback--base-ui-color;
} @else {
    $t: #999;
}
$fallback--search-form--ui-color:              $t !default;

$fallback--search-form--bg-color:              $fallback--search-form--ui-color !default;//lighten($fallback--search-form--ui-color, 60%) !default;

$fallback--search-form__field--bg-color:       #fff !default;
$fallback--search-form__field--bg-color--alt:  #ffffdc !default;

$fallback--search-form__submit--bg-color:      lighten($fallback--search-form--ui-color, 30%) !default;// lighten($fallback--search-form--ui-color, 70%) !default;
$fallback--search-form__submit--bg-color--alt: darken($fallback--search-form__submit--bg-color, 10%) !default;

$fallback--search-form__cancel--bg-color:      lighten($fallback--search-form--ui-color, 20%) !default;
$fallback--search-form__cancel--bg-color--alt: darken($fallback--search-form__cancel--bg-color, 10%) !default;


// Sizes:

$fallback--search-form--height:                20px !default;
$fallback--search-form--spacing:               5px !default;


// Breakpoints:

$fallback--search-form--breakpoint--enhanced:  720px !default;


// SVG's

$fallback--search-form__cancel--svg:           "data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgdmlld0JveD0iMCAwIDIwIDIwIj48cGF0aCAgZmlsbD0iIzQ0NDQ0NCIgZD0iTTE1LjgzMyA1LjM0NmwtMS4xNzktMS4xNzktNC42NTQgNC42NTQtNC42NTQtNC42NTQtMS4xNzkgMS4xNzkgNC42NTQgNC42NTQtNC42NTQgNC42NTQgMS4xNzkgMS4xNzkgNC42NTQtNC42NTQgNC42NTQgNC42NTQgMS4xNzktMS4xNzktNC42NTQtNC42NTR6Ij48L3BhdGg+PC9zdmc+" !default;


// Fall-Back PNG's:

$fallback--search-form__submit--png:           "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABTklEQVQ4T6VT21GDQBTNAv9qBaEDSQUij3+pQNMBnUgHagXJPw+3A0kFxg5SAA/P2VlmFtw4ZmQmA7t377nnsREr40mSJMfyEb9Ab7fjOBZ1Xb+Z58xvwUUYhtee570bjcvzbdd191LK07KgAOI4boUQt5j2hWXe933Lfdd1yaRAbY13W1XV5geApv3MZjQGyylkByAOWA/DsG2a5nUmwZieQevephVnHgCws7EQYDCyCRpvbBq1Rz48+uQ3ZCjZ0/N/gEskwKcDZE4RKxIiiqInx3FeUDzCxM0ZEz/ggW81cRHjEQdz+HHgPnQzWsbo26YrBtokRiV5F2wpsFnXJMAzk+XMUcohgwmIjWTA7JGWBPgdo0R9W5alumwzANv0ac+8UAA9ASRDpPLPAARK0zRAM5lccU1TLwJgE6SEePGPt1JMfqN9rqajLwCw/wY2tMxY4fByDwAAAABJRU5ErkJggg==" !default;


// MQ hacks:
$fallback--ie9--hack:                          "all and (min-width:0\0) and (min-resolution: .001dpcm)" !default;

/* -- Basic/fallback layout --------------------------------------------------------------------- */

    /*
        NOTES:
        
        .search-form--right
        It's not possible to easily re-create this variation so it won't be on the right in 
        non-flexbox browsers, but that's ok, it's still usable.
        IE 8 and 9 are forced into submission for this.
    
    */

    /* -- .search-form ---------------------------------------------------------------------------*/

    /*
        1. Prevent extra bottom space when form is inside a container.
    */
    .search-form {
        background: $fallback--search-form--bg-color;
    

        display: -webkit-flex;
        display: -ms-flexbox;
        display: flex;
        
        -webkit-flex-wrap: wrap;
            -ms-flex-wrap: wrap;
                flex-wrap: wrap;
                
        vertical-align: top;
    }
    
        .search-form:before,
        .search-form:after {
            content: " ";
            display: table;
        }

        .search-form:after {
            clear: both;
        }
    
    /* IE7- hacks (can't use MQ else IE8's Respond applies it): */
    .search-form {
        *zoom: 1;
        *padding-bottom: 5px;
    }
    
    /* -------------------------------------------------------------------------------------------*/
    
    /* -- .search-form__cancel -------------------------------------------------------------------*/
    
    .search-form__cancel {
        display: none;
    }
    
    /* -------------------------------------------------------------------------------------------*/
    
    /* -- .search-form__field --------------------------------------------------------------------*/

    /*
        1. This to override normalize.
    */
    .search-form__field {
        -webkit-appearance: none !important; /* [1] */
        -webkit-border-radius: 0px;
        border-radius: 0px;
        border: 0;
        -webkit-box-sizing: content-box;
        box-sizing: content-box;
        
        background-color: $fallback--search-form__field--bg-color;
        
        @include fallback-rem(height, $fallback--search-form--height);
        @include fallback-rem(line-height, $fallback--search-form--height);
        
        @include fallback-rem(margin, $fallback--search-form--spacing 0 $fallback--search-form--spacing $fallback--search-form--spacing);
        @include fallback-rem(padding, $fallback--search-form--spacing);

        float: left;

        -webkit-flex: 1 0 auto;
            -ms-flex: 1 0 auto;
                flex: 1 0 auto;
    }
    
    .search-form__field:focus {
        background-color: $fallback--search-form__field--bg-color--alt;
    }
    
    .search-form--right .search-form__field {        
         -webkit-order: 2;
        -ms-flex-order: 2;
                 order: 2;
    }

    /*
        Opera Hacks (https://github.com/jeffclayton/css_hack_testing/blob/master/opera_9.5-12_hack.txt)
        Opera Mini 7- ignores line height.
        Opera Mini 8 seems to enforce a minimum font size for the search field which forces it to be
        higher than it should be.
        min-height and no padding seems to fix it.
    */
    _:-o-prefocus, body:last-child .search-form__field {
        padding: 0;
        @include fallback-rem(min-height, ($fallback--search-form--height + ($fallback--search-form--spacing * 2)));
    }

    
    /* -------------------------------------------------------------------------------------------*/
    
    /* -- .search-form__submit -------------------------------------------------------------------*/
    
    /*
        1. IE 6/7 needs this.
    */
    .search-form__submit {
        -webkit-appearance: none;
        border-radius: 0;
        border: 0;
        -webkit-border-box: content-box;
        border-box: content-box;
        
        background: $fallback--search-form__submit--bg-color;
        
        @include fallback-rem(height, ($fallback--search-form--height + ($fallback--search-form--spacing * 2)));
        //@include fallback-rem(line-height, ($fallback--search-form--height + ($fallback--search-form--spacing * 2)));
        line-height: 0; /* [1] */
        *line-height: 1.5;
        
        @include fallback-rem(margin, $fallback--search-form--spacing $fallback--search-form--spacing $fallback--search-form--spacing 0);
        @include fallback-rem(padding, 0 ($fallback--search-form--spacing * 2));
        
        float: left;
        
        -webkit-flex: 0 1 auto;
            -ms-flex: 0 1 auto;
                flex: 0 1 auto;
    }

    .search-form__submit:hover,
    .search-form__submit:focus {
        background-color: $fallback--search-form__submit--bg-color--alt;
    }

    
    .search-form--right .search-form__submit {    
         -webkit-order: 2;
        -ms-flex-order: 2;
                 order: 2;
    }
    
    
    .search-form__submit svg {
        //vertical-align: middle;
        @include fallback-rem(height, $fallback--search-form--height);
        @include fallback-rem(width, $fallback--search-form--height);
    }
    
    
    /* PNG Fall-Back */    
    .no-inlinesvg.datauri .search-form__submit:before {
        content: url($fallback--search-form__submit--png);
        //vertical-align: middle;
    }
    
    .no-inlinesvg.datauri .search-form__submit span {
        display: none;
    }


    /* -------------------------------------------------------------------------------------------*/
    
    /* -- .search-form__collapse -----------------------------------------------------------------*/

    .search-form__collapse {          
        
        list-style-type: none;
        padding: 0;
        margin: 0;
        float: left;
        
        -webkit-box-flex: 0;
            -webkit-flex: 0 1 auto;
                -ms-flex: 0 1 auto;
                    flex: 0 1 auto;
    }
    
    /* -------------------------------------------------------------------------------------------*/
    
    
        
    /* IE8 hacks: */
    @media \0screen {
        
        .search-form--right .search-form__submit,
        .search-form--right .search-form__field {
            float: right;
        }
        
        .search-form--right .search-form__field {
            margin-left: -340px; /* @var */
            margin-right: 20px; /* @var */
        }

    }
    
    /* IE9 hacks: */
    @media all and (min-width:0\0) and (min-resolution: .001dpcm)
    {
        .search-form--right .search-form__submit,
        .search-form--right .search-form__field {
            float: right;
        }
        
        .search-form--right .search-form__field {
            margin-left: -340px; /* @var */
            margin-right: 20px; /* @var */
        }
        
    }

    

/* -- Enhanced layout --------------------------------------------------------------------------- */
    @media only screen and (max-width: ($fallback--search-form--breakpoint--enhanced - 1)) {
        
        .search-form--right .search-form__submit,
        .search-form--right .search-form__field {
            float: left;
        }
        
        .search-form--right .search-form__field {
            @include fallback-rem(margin-left, $fallback--search-form--spacing);
            margin-right: 0;
        }
        
        .search-form__collapse {
            width: 100%;
        }
        
        
        .no-flexbox .search-form {
            display: block;
        }
    }
    
    @media only screen and (min-width: $fallback--search-form--breakpoint--enhanced) {
    
        /*
            Older FF flexbox doesn't support flex wrap so basic layout breaks. Adding old -moz 
            flexbox for the enhanced width old solves this problem.
        */
        .search-form {
            display: -moz-box;
            width: 100%;
        }
        
        .search-form__field {
            -moz-box-flex: 1;
        }
        
        .search-form__submit {
            -moz-box-flex: 0;
        }
        
        .search-form__collapse {
            -moz-box-flex: 0;
        }
        
        .search-form__cancel {
            -moz-box-flex: 0;
            -moz-box-ordinal-group: 0;
        }
        
        .search-form--right .search-form__field,
        .search-form--right .search-form__submit {
            -moz-box-ordinal-group: 2;
        }
    

        .search-form__cancel {
            display: none;
            
            background-color: $fallback--search-form__cancel--bg-color;
            
            @include fallback-rem(padding-right, ($fallback--search-form--spacing * 2));
            @include fallback-rem(padding-left, ($fallback--search-form--spacing * 2));

            @include fallback-rem(height, ($fallback--search-form--height + ($fallback--search-form--spacing * 4)));
            @include fallback-rem(line-height, ($fallback--search-form--height + ($fallback--search-form--spacing * 4)));
            @include fallback-rem(width, ($fallback--search-form--height + ($fallback--search-form--spacing * 4)));

            -webkit-flex: 0 0 auto;
                -ms-flex: 0 0 auto;
                    flex: 0 0 auto;
                    
             -webkit-order: -1;
            -ms-flex-order: -1;
                     order: -1;
        }
        
        .search-form__cancel:hover,
        .search-form__cancel:focus,
        .search-form__cancel:active {
            background-color: $fallback--search-form__cancel--bg-color--alt;
        }
        
        .search-form__cancel:after {
            content: url($fallback--search-form__cancel--svg);
            
            display: inline-block;
            vertical-align: middle;
            /* IE10-11 flexbox chokes without width: */
            width:  20px;
            /* IE11 flexbox stretches icon without height: */
            height:  20px;
            /* But now blink pushes the icon to the bottom without line-height: 0. */
            line-height: 0;
        }

        .search-form__field {
            width: auto;
        }
        
        /*
            Expander
        */        
        .search-form__field:focus ~ .search-form__collapse {
            display: none;
        }
        
        /*
            Cancel button
            Note: only necessary on some touch devices where it can be difficult to un-focus.
        */
        .search-form__field:focus ~ .search-form__cancel {           
            display: block;
        }
        
        /*
            Expander issue:
            Collapse block is hidden but search field doesn't expand so it looks weird.
            Affects: browsers that DON'T support flexbox, but DO support :focus ~ selector.
                IE9 - had to use hack - see below.
                FF3.5 - 21 (note - look into using the -moz prefix for flexbox in this case for 8+)
                Safari6 (CSS Cutt-off won't load CSS for this browser so shouldn't be an issue any more)
           
            
        
            --Modernizr adds the .flexbox class. If JS unavailable, expanding doesn't work.
            That's ok, but I may as well just have used JS to make the expanding working the first
            place!!!!??? :-(--
            
            If no-flexbox, undo Expander and Cancel.
            Note, without JS the issue described above will still occur, but it's still usable.

        */
        /*.no-flexbox .search-form__field:focus ~ .search-form__collapse {
            display: block;
        }
        
        .no-flexbox .search-form__field:focus ~ .search-form__cancel {
            display: none;
        }*/
        
        
        .search-form__collapse {          
            width: auto;
        }
    }
    
    
    /* IE9 hacks: */
    /*
        Expander issue: Collapse block is hidden but search field doesn't expand so it looks weird.
    */
    @media #{$fallback--ie9--hack} {
        .search-form__field:focus ~ .search-form__collapse {
            display: block;
        }
        
        .search-form__field:focus ~ .search-form__cancel {
            display: none;
        }
        
    }
    
    
    
    /*
    Older webkit browsers - those supporting the -webkit-box-flex syntax (Chrome 21-28, Maxthon) 
    - don't let the flex declarations override floats properly, so the the floats applied above
    cause serious breakage, so we need to undo those floats.
    Also the vertical centering of the cancel icon doesn't work properly, so we provide a fix
    for that too.
    Applies to newer webkit too, but works just as well. Mainly this prevents IE10 from
    applying this (where the cancel icon styling fails).
    However, older webkit (Safari, Android) baulk at this so following are some hacks to reset the float.
    Horrid but haven't found a better way yet.
    Can't use JS to detect these either, as it's totally broken if JS isn't available.
    
    */
    /* no longer applies due to CSS Cutt-off
    @media screen and (-webkit-min-device-pixel-ratio: 0) {
        .search-form__submit,
        .search-form__field,
        .search-form__collapse {
            float: none;
        }

        .search-form__cancel:after {
            display: table-cell;
            height: 40px;
            height: 4rem;
        }
    }*/

    /* Android 2.3+ and Safari 3-4 */
    /*@media screen and (min-width: 0\-) {
        .search-form__submit,
        .search-form__field,
        .search-form__collapse {
            float: left;
        }
    }*/

    /* iOS (iOS Safari 3.2+), Android (Base browser 2.1+ & Chrome 22+, Opera Mobile 10+) */
    /*@media screen and (-webkit-min-device-pixel-ratio:1.1) {
        .search-form__submit,
        .search-form__field,
        .search-form__collapse {
            float: left;
        }
    }*/

/* ---------------------------------------------------------------------------------------------- */